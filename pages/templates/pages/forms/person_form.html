{% extends "pages/base.html" %}
{% load static %}

{% block title %}
    {% if object %}Editar Pessoa - {{ object.full_name }}{% else %}Nova Pessoa{% endif %} - Athena
{% endblock %}

<!-- ✅ MASTHEAD COMPACTO -->
{% block masthead_class %} masthead--compact{% endblock %}

{% block hero_content %}
<div class="container px-4 px-lg-5 text-center">
    <h1 class="text-white">
        {% if object %}
            <i class="fas fa-user-edit me-2"></i>Editar Pessoa
        {% else %}
            <i class="fas fa-user-plus me-2"></i>Nova Pessoa
        {% endif %}
    </h1>
    <p class="text-white-50">
        {% if object %}
            Atualize as informações de {{ object.full_name }}
        {% else %}
            Cadastre uma nova pessoa física no sistema
        {% endif %}
    </p>
</div>
{% endblock %}

{% block about_content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            
            <div class="text-center mb-4">
                <h1 class="h3 text-white">
                    {% if object %}
                        <i class="fas fa-user-edit me-2"></i>Editar Pessoa
                    {% else %}
                        <i class="fas fa-user-plus me-2"></i>Cadastrar Nova Pessoa
                    {% endif %}
                </h1>
                <p class="text-white-50">
                    {% if object %}
                        Atualize as informações de {{ object.full_name }}
                    {% else %}
                        Cadastre uma nova pessoa física no sistema
                    {% endif %}
                </p>
            </div>

            <!-- Formulário -->
            <div class="card bg-dark border-primary shadow-lg">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-form me-2"></i>Dados da Pessoa
                    </h5>
                </div>
                <div class="card-body p-4">
                    
                    {% if form.errors %}
                        <div class="alert alert-danger mb-4">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Erro nos dados!</strong> Verifique os campos abaixo.
                        </div>
                    {% endif %}

                    <form method="post" novalidate>
                        {% csrf_token %}
                        
                        <div class="row">
                            <!-- Nome Completo -->
                            <div class="col-md-12 mb-3">
                                <label for="{{ form.full_name.id_for_label }}" class="form-label text-white">
                                    <i class="fas fa-user me-2"></i>{{ form.full_name.label }}
                                    <span class="text-danger">*</span>
                                </label>
                                {{ form.full_name }}
                                {% if form.full_name.errors %}
                                    <div class="text-danger mt-1">
                                        {% for error in form.full_name.errors %}
                                            <small><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- CPF com máscara -->
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.cpf.id_for_label }}" class="form-label text-white">
                                        <i class="fas fa-id-card me-1"></i>CPF <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" 
                                           name="cpf" 
                                           id="{{ form.cpf.id_for_label }}"
                                           class="form-control" 
                                           data-mask="cpf"
                                           placeholder="000.000.000-00"
                                           value="{{ form.cpf.value|default:'' }}"
                                           required>
                                    {% if form.cpf.errors %}
                                        <div class="text-danger small">{{ form.cpf.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Telefone com máscara -->
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.phone.id_for_label }}" class="form-label text-white">
                                        <i class="fas fa-phone me-1"></i>Telefone
                                    </label>
                                    <input type="text" 
                                           name="phone" 
                                           id="{{ form.phone.id_for_label }}"
                                           class="form-control" 
                                           data-mask="telefone"
                                           placeholder="(00) 00000-0000"
                                           value="{{ form.phone.value|default:'' }}">
                                    {% if form.phone.errors %}
                                        <div class="text-danger small">{{ form.phone.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Data de nascimento com calendário -->
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.birth_date.id_for_label }}" class="form-label text-white">
                                        <i class="fas fa-calendar me-1"></i>Data de Nascimento <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" 
                                           name="birth_date" 
                                           id="{{ form.birth_date.id_for_label }}"
                                           class="form-control" 
                                           data-datepicker
                                           placeholder="Selecione a data"
                                           value="{{ form.birth_date.value|date:'Y-m-d'|default:'' }}"
                                           required>
                                    {% if form.birth_date.errors %}
                                        <div class="text-danger small">{{ form.birth_date.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Cidade -->
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.city.id_for_label }}" class="form-label text-white">
                                    <i class="fas fa-map-marker-alt me-2"></i>{{ form.city.label }}
                                    <span class="text-danger">*</span>
                                </label>
                                {{ form.city }}
                                {% if form.city.errors %}
                                    <div class="text-danger mt-1">
                                        {% for error in form.city.errors %}
                                            <small><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Endereço -->
                            <div class="col-md-12 mb-3">
                                <label for="{{ form.address.id_for_label }}" class="form-label text-white">
                                    <i class="fas fa-home me-2"></i>{{ form.address.label }}
                                    <span class="text-danger">*</span>
                                </label>
                                {{ form.address }}
                                {% if form.address.errors %}
                                    <div class="text-danger mt-1">
                                        {% for error in form.address.errors %}
                                            <small><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Finalidade do Tratamento LGPD -->
                            <div class="col-md-12 mb-4">
                                <label for="{{ form.data_processing_purpose.id_for_label }}" class="form-label text-white">
                                    <i class="fas fa-shield-alt me-2"></i>{{ form.data_processing_purpose.label }}
                                    <span class="text-danger">*</span>
                                </label>
                                {{ form.data_processing_purpose }}
                                {% if form.data_processing_purpose.errors %}
                                    <div class="text-danger mt-1">
                                        {% for error in form.data_processing_purpose.errors %}
                                            <small><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                <small class="form-text text-white-50">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Conforme LGPD, é obrigatório informar a finalidade do tratamento dos dados pessoais.
                                </small>
                            </div>
                        </div>

                        <!-- Botões de Ação -->
                        <div class="row">
                            <div class="col-12">
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <a href="{% url 'person-list' %}" class="btn btn-secondary btn-lg me-md-2">
                                        <i class="fas fa-arrow-left me-2"></i>Cancelar
                                    </a>
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        {% if object %}
                                            <i class="fas fa-save me-2"></i>Atualizar Pessoa
                                        {% else %}
                                            <i class="fas fa-plus me-2"></i>Cadastrar Pessoa
                                        {% endif %}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Informações de Ajuda -->
            <div class="card bg-secondary text-white mt-4">
                <div class="card-body">
                    <h6><i class="fas fa-info-circle me-2"></i>Informações Importantes</h6>
                    <ul class="mb-0 small">
                        <li>Todos os campos marcados com <span class="text-danger">*</span> são obrigatórios</li>
                        <li>O CPF deve estar no formato: 123.456.789-00</li>
                        <li>O telefone deve estar no formato: (11) 99999-9999</li>
                        <li>A finalidade do tratamento é obrigatória conforme LGPD</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block about_image %}{% endblock %}
{% block projects_content %}{% endblock %}
{% block signup_content %}{% endblock %}
{% block contact_content %}{% endblock %}
{% block copyright %}Projeto Athena LGPD 2025{% endblock %}

<!-- ✅ MÁSCARAS E CALENDÁRIO -->
{% block extra_js %}
<script>
$(function(){
    // ✅ MÁSCARAS
    $('[data-mask="cpf"]').inputmask('999.999.999-99');
    $('[data-mask="telefone"]').inputmask('(99) 99999-9999');
    
    // ✅ CALENDÁRIO (FLATPICKR)
    $('[data-datepicker]').flatpickr({
        dateFormat: 'Y-m-d',
        locale: 'pt',
        maxDate: 'today',
        altInput: true,
        altFormat: 'd/m/Y'
    });
});
</script>
{% endblock %}