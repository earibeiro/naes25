{% extends "pages/base.html" %}
{% load static %}

{% block title %}Contratos - Athena{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item active"><i class="fas fa-file-contract me-1"></i>Contratos</li>
{% endblock %}

{% block masthead_class %} masthead--compact{% endblock %}

{% block hero_content %}
<div class="container px-4 px-lg-5 text-center">
    <h1 class="text-white">üìã Contratos LGPD</h1>
    <p class="text-white-50">Gest√£o completa de contratos e documenta√ß√£o</p>
</div>
{% endblock %}

{% block about_content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 m-0 text-white">
            <i class="fas fa-file-contract me-2"></i>Contratos
        </h1>
        <a class="btn btn-success" href="{% url 'contract-create' %}">
            <i class="fas fa-plus me-2"></i>Novo Contrato
        </a>
    </div>

    <!-- FILTROS -->
    <div class="card bg-dark text-white mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-filter me-2"></i>Filtros de Busca
            </h5>
        </div>
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">{{ filter.form.title.label }}</label>
                    {{ filter.form.title }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ filter.form.empresa.label }}</label>
                    {{ filter.form.empresa }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ filter.form.pessoa.label }}</label>
                    {{ filter.form.pessoa }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ filter.form.contract_type.label }}</label>
                    {{ filter.form.contract_type }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ filter.form.is_active.label }}</label>
                    {{ filter.form.is_active }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ filter.form.criado_de.label }}</label>
                    {{ filter.form.criado_de }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ filter.form.criado_ate.label }}</label>
                    {{ filter.form.criado_ate }}
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="fas fa-search me-1"></i>Filtrar
                    </button>
                    <a href="{% url 'contract-list' %}" class="btn btn-secondary">
                        <i class="fas fa-times me-1"></i>Limpar
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Lista de Contratos -->
    <div class="card bg-dark text-white">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-list me-2"></i>Lista de Contratos
            </h5>
        </div>
        <div class="card-body">
            {% if contracts %}
                <div class="table-responsive">
                    <!-- ‚úÖ ADICIONAR ID PARA DATATABLES -->
                    <table id="dt-list" class="table table-dark table-striped table-hover">
                        <thead>
                            <tr>
                                <th><i class="fas fa-file-contract me-1"></i>T√≠tulo</th>
                                <th><i class="fas fa-building me-1"></i>Empresa</th>
                                <th><i class="fas fa-user me-1"></i>Pessoa</th>
                                <th><i class="fas fa-calendar me-1"></i>Per√≠odo</th>
                                <th><i class="fas fa-info-circle me-1"></i>Status</th>
                                <th><i class="fas fa-cogs me-1"></i>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for contract in contracts %}
                                <tr>
                                    <td>
                                        <strong>{{ contract.title|truncatechars:30 }}</strong>
                                        <br><small class="text-muted">{{ contract.description|truncatechars:40 }}</small>
                                    </td>
                                    <td>
                                        <i class="fas fa-building text-warning me-1"></i>
                                        {{ contract.company.corporate_name|truncatechars:25 }}
                                    </td>
                                    <td>
                                        <i class="fas fa-user text-primary me-1"></i>
                                        {{ contract.person.full_name|truncatechars:25 }}
                                    </td>
                                    <td>
                                        <small>
                                            <strong>In√≠cio:</strong> {{ contract.start_date|date:"d/m/Y" }}<br>
                                            {% if contract.end_date %}
                                                <strong>Fim:</strong> {{ contract.end_date|date:"d/m/Y" }}
                                            {% else %}
                                                <span class="text-info">Indeterminado</span>
                                            {% endif %}
                                        </small>
                                    </td>
                                    <td>
                                        {% if contract.is_active %}
                                            <span class="badge bg-success">
                                                <i class="fas fa-check me-1"></i>Ativo
                                            </span>
                                        {% else %}
                                            <span class="badge bg-secondary">
                                                <i class="fas fa-times me-1"></i>Inativo
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm" role="group">
                                            <a href="{% url 'contract-detail' contract.pk %}" class="btn btn-outline-info" title="Visualizar">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="{% url 'contract-update' contract.pk %}" class="btn btn-outline-warning" title="Editar">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a href="{% url 'contract-delete' contract.pk %}" class="btn btn-outline-danger" title="Excluir">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <!-- ‚úÖ EMPTY STATE MELHORADO -->
                <div class="card bg-dark text-white shadow rounded-4">
                    <div class="card-body text-center py-5">
                        <i class="fas fa-file-contract fa-5x text-muted mb-4"></i>
                        <h4 class="text-white mb-3">Nenhum contrato encontrado</h4>
                        <p class="text-white-50 mb-4">
                            {% if request.GET %}
                                Nenhum contrato corresponde aos filtros aplicados.
                                <a href="{% url 'contract-list' %}" class="alert-link text-warning">Limpar filtros</a>
                            {% else %}
                                Comece criando seu primeiro contrato no sistema.
                            {% endif %}
                        </p>
                        <a href="{% url 'contract-create' %}" class="btn btn-success btn-lg">
                            <i class="fas fa-plus me-2"></i>Criar Primeiro Contrato
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block about_image %}{% endblock %}
{% block projects_content %}{% endblock %}
{% block signup_content %}{% endblock %}
{% block contact_content %}{% endblock %}
{% block copyright %}Projeto Athena LGPD 2025{% endblock %}

<!-- ‚úÖ DATATABLES INITIALIZATION -->
{% block extra_js %}
<script>
$(function(){
    const $t = $('#dt-list');
    if($t.length){
        new DataTable('#dt-list', {
            pageLength: 10,
            order: [[0, 'asc']], // Ordenar por t√≠tulo
            language: { 
                url: 'https://cdn.datatables.net/plug-ins/1.13.7/i18n/pt-BR.json' 
            },
            // Desabilitar ordena√ß√£o na coluna de a√ß√µes
            columnDefs: [
                { orderable: false, targets: 5 }
            ]
        });
    }
});
</script>
{% endblock %}